<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Printxe3D — E‑commerce 3D (Démo HTML)</title>
  <meta name="description" content="Printxe3D – Impression 3D futuriste. Boutique, configurateur 3D, checkout invité." />
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;800&family=Orbitron:wght@600;800&display=swap" rel="stylesheet">
  <style>
    :root{
      --bg:#000;--bg-soft:#0a0a0a;--text:#fff;--muted:#bfbfbf;--accent:#D7FF2F;
      --radius:16px;--shadow:0 10px 30px rgba(215,255,47,.15);
    }
    *{box-sizing:border-box}
    html,body{margin:0;background:var(--bg);color:var(--text);font-family:Inter,system-ui,-apple-system,Segoe UI,Roboto,Ubuntu,Cantarell,Noto Sans,sans-serif;}
    a{color:inherit;text-decoration:none}
    img{max-width:100%;display:block}
    .container{max-width:1180px;margin:0 auto;padding:0 20px}
    .btn{display:inline-flex;align-items:center;gap:.5rem;padding:.9rem 1.2rem;border-radius:var(--radius);cursor:pointer;border:1px solid transparent;transition:.2s transform,.2s filter,.2s background,.2s border-color}
    .btn:hover{transform:translateY(-1px)}
    .btn-acc{background:var(--accent);color:#000;box-shadow:var(--shadow);font-weight:800}
    .btn-ghost{background:transparent;border-color:var(--accent);color:var(--text)}
    .chip{font-size:.7rem;text-transform:uppercase;letter-spacing:.12em;color:#111;background:var(--accent);border-radius:999px;padding:.25rem .6rem;font-weight:800}
    header.site{position:sticky;top:0;z-index:50;backdrop-filter:blur(6px);background:rgba(0,0,0,.6);border-bottom:1px solid rgba(255,255,255,.06)}
    header .row{height:64px;display:flex;align-items:center;justify-content:space-between}
    nav a {
  position: relative;
  opacity: .9;
  margin: 0 .8rem;
  padding-bottom: 2px;
  transition: color .22s;
}
nav a.active,
nav a:hover {
  color: var(--accent);
}
nav a::after {
  content: "";
  display: block;
  position: absolute;
  left: 0; right: 0; bottom: 0;
  height: 2.5px;
  background: var(--accent);
  border-radius: 2px;
  opacity: 0;
  transform: scaleX(0.5);
  transition: opacity .22s, transform .22s;
}
nav a.active::after,
nav a:hover::after {
  opacity: 1;
  transform: scaleX(1);
}
    .logo{display:flex;align-items:center;gap:.7rem}
    .logo svg{height:28px}
    .pill{display:inline-flex;align-items:center;gap:.4rem;border:1px solid rgba(255,255,255,.12);border-radius:999px;padding:.35rem .6rem;background:#0b0b0b}
    .grid{display:grid;gap:20px}
    .card{background:var(--bg-soft);border:1px solid rgba(255,255,255,.06);border-radius:var(--radius)}
    .card.pad{padding:20px}
    .shadow{box-shadow:0 10px 24px rgba(0,0,0,.35)}
    .muted{color:var(--muted)}
    .title{font-family:Orbitron,Inter,sans-serif}
    .h1{font-size:clamp(32px,5vw,56px);line-height:1.05;margin:0}
    .h2{font-family:Orbitron,Inter,sans-serif;font-size:clamp(22px,3vw,30px);margin:0 0 10px}
    .h3{font-weight:700;margin:0 0 6px}
    .section{padding:64px 0}

    /* HERO */
    .hero {
      position: relative;
      overflow: hidden;
      /* Même fond que le body, mais avec un effet supplémentaire */
      background:
        radial-gradient(1000px 600px at 50% 0%, rgba(215,255,47,0.10), transparent 80%),
        radial-gradient(ellipse at 70% 20%, rgba(215,255,47,0.13) 0%, transparent 70%),
        radial-gradient(ellipse at 20% 80%, rgba(215,255,47,0.09) 0%, transparent 70%),
        linear-gradient(120deg, #181818 0%, #000 100%);
    }
    .halo{position:absolute;inset:-20%;background:radial-gradient(700px 400px at 70% 30%, rgba(215,255,47,.25), transparent 60%);filter:blur(40px);opacity:.4;pointer-events:none}
    .heroRow{display:grid;grid-template-columns:1.2fr .8fr;gap:28px;align-items:center}
    @media (max-width:900px){.heroRow{grid-template-columns:1fr}}
    .viewer{height:420px;border-radius:var(--radius);background:var(--bg-soft);border:1px solid rgba(255,255,255,.06)}

    /* FEATURES */
    .featGrid{grid-template-columns:repeat(4,1fr)}
    @media (max-width:900px){.featGrid{grid-template-columns:repeat(2,1fr)}}

    /* STORE */
    .toolbar{display:flex;flex-direction:row !important;gap:10px;align-items:flex-end;min-width:0;max-width:none}
    .toolbar input,.toolbar select{background:#0b0b0b;border:1px solid rgba(255,255,255,.12);color:var(--text);border-radius:12px;padding:.6rem .8rem;outline:none}
    .prodGrid {
  display: grid;
  grid-template-columns: repeat(4, minmax(220px, 1fr)); /* Taille mini des cartes */
  gap: 20px;
  margin-top: 16px;
  width: 100%;
  max-width: 1180px;
  margin-left: auto;
  margin-right: auto;
  box-sizing: border-box;
  justify-items: center; /* Centre chaque carte dans sa colonne */
}
    .card.prod.shadow {
  width: 100%;           /* Prend toute la largeur de la colonne */
  max-width: 260px;      /* Taille max d'une carte */
  min-width: 180px;      /* Taille mini d'une carte */
  flex: 1 1 220px;       /* Permet de s'adapter à la grille */
  box-sizing: border-box;
}
    @media (max-width:1100px){.prodGrid{grid-template-columns:repeat(3,minmax(220px,1fr))}}
    @media (max-width:800px){.prodGrid{grid-template-columns:repeat(2,minmax(220px,1fr))}}
    @media (max-width:520px){.prodGrid{grid-template-columns:1fr}}
    .thumb{
  aspect-ratio:1/1;
  border-bottom:1px solid rgba(255,255,255,.06);
  background:linear-gradient(135deg,#1a1a1a,#0f0f0f);
  position:relative;
  overflow:hidden;
  border-radius: 14px; /* <-- Ajoute cette ligne ou augmente la valeur */
}
    .price{font-weight:800;color:var(--accent)}
    .prod{display:flex;flex-direction:column}
    .prod .pad{padding:14px}
    .prod:hover {
  box-shadow: 0 8px 32px 0 rgba(215,255,47,0.18), 0 1.5px 8px 0 rgba(0,0,0,0.18);
  transform: translateY(-6px) scale(1.025);
  border-color: var(--accent);
  transition: box-shadow .25s, transform .25s;
}
    .prod {
  opacity: 0;
  transform: translateY(30px);
  animation: prodIn 0.7s cubic-bezier(.33,1.02,.47,.98) forwards;
}
@keyframes prodIn {
  to {
    opacity: 1;
    transform: translateY(0);
  }
}

    /* PRODUCT MODAL */
    .modal{position:fixed;inset:0;display:none;place-items:center;background:rgba(0,0,0,.7);z-index:60}
    .modal.open{display:grid}
    .modal .box{width:min(980px,92vw);max-height:92vh;overflow:auto}
    .variantRow{display:flex;flex-wrap:wrap;gap:10px}
    .variantRow select{background:#0b0b0b;border:1px solid rgba(255,255,255,.12);color:var(--text);border-radius:12px;padding:.5rem .7rem}

    /* CART */
    .cart{position:fixed;inset:0;z-index:70;display:none}
    .cart.open{display:block}
    .cart .back{position:absolute;inset:0;background:rgba(0,0,0,.7)}
    .cart aside{position:absolute;right:0;top:0;height:100%;width:min(420px,96vw);background:#0b0b0b;border-left:1px solid rgba(255,255,255,.12);padding:18px;transform:translateX(100%);transition:.25s transform}
    .cart.open aside{transform:translateX(0)}

    /* TABS */
    .tabs{display:flex;gap:8px;flex-wrap:wrap}
    .tabs button{background:#0b0b0b;border:1px solid rgba(255,255,255,.12);color:var(--text);border-radius:999px;padding:.45rem .9rem}
    .tabs button.active{background:var(--accent);color:#000;font-weight:800}

    footer{border-top:1px solid rgba(255,255,255,.06)}

    /* INPUTS */
.input, textarea, select {
  background: #0b0b0b;
  border: 1px solid rgba(255,255,255,.12);
  color: var(--text);
  border-radius: 12px;
  padding: .6rem .8rem;
  outline: none;
  font-size: 1rem;
  width: 100%;
  box-sizing: border-box;
  transition: border-color .2s;
}
.input:focus, textarea:focus, select:focus {
  border-color: var(--accent);
}
body {
  /* Dégradé radial avec couleurs du logo Printxe3D (vert fluo et noir) */
  background:
    radial-gradient(ellipse at 70% 20%, rgba(215,255,47,0.13) 0%, transparent 70%),
    radial-gradient(ellipse at 20% 80%, rgba(215,255,47,0.09) 0%, transparent 70%),
    linear-gradient(120deg, #181818 0%, #000 100%);
}

/* Halo animé avec la couleur accent du logo */
@keyframes greenGlow {
  0% { filter: blur(60px) brightness(1.1); opacity: 0.18; }
  50% { filter: blur(80px) brightness(1.3); opacity: 0.28; }
  100% { filter: blur(60px) brightness(1.1); opacity: 0.18; }
}
.bg-green-halo {
  position: fixed;
  z-index: 0;
  pointer-events: none;
  left: 0; top: 0; width: 100vw; height: 100vh;
  background: radial-gradient(circle at 60% 30%, #D7FF2F 0%, transparent 70%);
  opacity: 0.22;
  animation: greenGlow 6s infinite;
}

#heroViewer {
  background: transparent !important;
  border: none !important;
  border-radius: 0 !important;
  box-shadow: none !important;
  overflow: visible !important;
}

/* Remonte le canvas du model-viewer dans le HERO */
#heroViewer model-viewer {
  display: block;
  margin-top: -100px; /* Ajuste la valeur selon le rendu souhaité */
}

/* Ajoute ces animations globales à la fin de ta balise <style> */

body, .hero, .section, .card, .prod, .toolbar, header.site, footer, .bg-green-halo {
  animation: fadeInSite 1.1s cubic-bezier(.33,1.02,.47,.98) both;
}

@keyframes fadeInSite {
  from {
    opacity: 0;
    filter: blur(12px);
    transform: translateY(40px) scale(0.98);
  }
  to {
    opacity: 1;
    filter: blur(0);
    transform: translateY(0) scale(1);
  }
}

/* Animation douce sur hover pour les .card et .prod */
.card, .prod {
  transition: box-shadow .25s, transform .25s, filter .25s, opacity .25s;
}
.card:hover, .prod:hover {
  filter: brightness(1.07) drop-shadow(0 0 16px #d7ff2f33);
  transform: translateY(-6px) scale(1.025);
  box-shadow: 0 8px 32px 0 rgba(215,255,47,0.18), 0 1.5px 8px 0 rgba(0,0,0,0.18);
  z-index: 2;
}

/* Animation sur les boutons */
.btn, .btn-acc, .btn-ghost {
  transition: background .22s, color .22s, transform .18s, box-shadow .22s;
}
.btn:hover, .btn-acc:hover, .btn-ghost:hover {
  box-shadow: 0 2px 12px 0 #d7ff2f44;
  transform: translateY(-2px) scale(1.04);
}

/* Animation sur les titres */
.h1, .h2, .h3 {
  animation: fadeInTitle 1.2s cubic-bezier(.33,1.02,.47,.98) both;
}
@keyframes fadeInTitle {
  from {
    opacity: 0;
    letter-spacing: 0.2em;
    filter: blur(8px);
    transform: translateY(30px);
  }
  to {
    opacity: 1;
    letter-spacing: normal;
    filter: blur(0);
    transform: translateY(0);
  }
}

/* Ajoute ce CSS à la fin de ta balise <style> pour appliquer la DA (direction artistique) au bouton #loadMore */

#loadMore {
  background: var(--accent);
  color: #111;
  font-weight: 800;
  border-radius: var(--radius);
  border: 1.5px solid var(--accent);
  box-shadow: 0 4px 18px 0 rgba(215,255,47,0.13);
  letter-spacing: 0.04em;
  font-size: 1.08rem;
  transition: background .22s, color .22s, transform .18s, box-shadow .22s;
}
#loadMore:hover {
  background: #fff700;
  color: #000;
  box-shadow: 0 2px 16px 0 #d7ff2f44;
  transform: translateY(-2px) scale(1.04);
  border-color: #fff700;
}

/* Ajoute ce CSS à la fin de ta balise <style> pour espacer le titre et les cartes de la section Pourquoi Printxe3D */
.section .h2 {
  margin-bottom: 32px;
}
.featGrid {
  row-gap: 32px;
}
header.site .container.row {
  display: flex;
  align-items: center;
  justify-content: space-between;
}
header.site nav {
  flex: 1;
  display: flex;
  justify-content: center;
  gap: 1.5rem;
}

#openCart {
  width: 86.81px;
  height: 40px;
  min-width: 86.81px;
  min-height: 40px;
  max-width: 86.81px;
  max-height: 40px;
  padding: 0;
  font-size: 1rem;
  display: inline-flex;
  align-items: center;
  justify-content: center;
}

/* Ajoute ou modifie ce CSS dans ta balise <style> principale pour le bouton Voir + */
.btn.btn-view {
  background: #eaeaea !important;
  color: #222 !important;
  border: none;
  border-radius: var(--radius);
  font-weight: 600;
  font-size: 0.98rem;
  padding: 0.5rem 2.2rem;
  min-height: 32px;
  height: 32px;
  width: 100%;
  margin-top: 8px;
  transition: background .18s, color .18s, box-shadow .18s;
  box-shadow: 0 2px 8px rgba(0,0,0,0.07);
}
.btn.btn-view:hover {
  background: #f5f5f5 !important;
  color: #000 !important;
  box-shadow: 0 4px 18px #d7ff2f22;
}
.feature-card {
  position: relative;
  overflow: hidden;
  background: linear-gradient(120deg, #111 60%, #181818 100%);
  border: 1.5px solid rgba(215,255,47,0.08);
  transition: box-shadow .22s, border-color .22s, transform .22s;
}
.feature-card:hover {
  border-color: var(--accent);
  box-shadow: 0 0 24px 0 #d7ff2f33, 0 2px 12px 0 #000;
  transform: translateY(-6px) scale(1.025);
}
.feature-ico {
  width: 54px;
  height: 54px;
  display: flex;
  align-items: center;
  justify-content: center;
  border-radius: 14px;
  margin-bottom: 18px;
  margin-top: -8px;
  box-shadow: 0 2px 12px #d7ff2f22;
}
.feature-card .h3.accent {
  color: var(--accent);
  font-family: Orbitron, Inter, sans-serif;
  font-size: 1.18rem;
  margin-bottom: 8px;
  margin-top: 0;
  letter-spacing: .01em;
}
.faq-card {
  position: relative;
  overflow: hidden;
  background: linear-gradient(120deg, #111 60%, #181818 100%);
  border: 1.5px solid rgba(215,255,47,0.08);
  transition: box-shadow .22s, border-color .22s, transform .22s;
}
.faq-card:hover {
  border-color: var(--accent);
  box-shadow: 0 0 24px 0 #d7ff2f33, 0 2px 12px 0 #000;
  transform: translateY(-6px) scale(1.025);
}
.faq-ico {
  width: 54px;
  height: 54px;
  display: flex;
  align-items: center;
  justify-content: center;
  border-radius: 14px;
  margin-bottom: 18px;
  margin-top: -8px;
  box-shadow: 0 2px 12px #d7ff2f22;
}
.faq-card .h3.accent {
  color: var(--accent);
  font-family: Orbitron, Inter, sans-serif;
  font-size: 1.13rem;
  margin-bottom: 8px;
  margin-top: 0;
  letter-spacing: .01em;
}

/* FAQ Accordéon Glow + Animation */
.faq-accordion {
  background: linear-gradient(120deg, #111 60%, #181818 100%);
  border: 1.5px solid rgba(215,255,47,0.13);
  border-radius: var(--radius);
  margin-bottom: 18px;
  box-shadow: 0 0 24px 0 #d7ff2f22, 0 2px 12px 0 #000;
  transition: box-shadow .22s, border-color .22s, transform .22s;
  overflow: hidden;
  position: relative;
}
.faq-accordion[open] {
  border-color: var(--accent);
  box-shadow: 0 0 32px 0 #d7ff2f44, 0 2px 12px 0 #000;
}
.faq-accordion summary {
  display: flex;
  align-items: center;
  gap: 14px;
  cursor: pointer;
  font-weight: 600;
  font-size: 1.08rem;
  padding: 18px 0 18px 0;
  outline: none;
  color: var(--accent);
  background: none;
  border: none;
  user-select: none;
  transition: color .18s;
  /* Ajoute cette ligne pour forcer la hauteur minimale */
  min-height: 54px;
}
.faq-accordion .faq-ico {
  width: 38px;
  height: 38px;
  display: flex;
  align-items: center;
  justify-content: center;
  background: rgba(215,255,47,0.10);
  border-radius: 12px;
  margin-right: 2px;
  margin-left: 18px; /* Ajoute cette ligne pour décaler à droite */
  box-shadow: 0 2px 12px #d7ff2f22;
  flex-shrink: 0;
  margin-top: 0;
  margin-bottom: 0;
}
.faq-accordion p {
  margin: 0 0 18px 52px;
  color: var(--muted);
  font-size: 1.01rem;
  line-height: 1.6;
  letter-spacing: .01em;
  opacity: 0;
  max-height: 0;
  transition: opacity .35s, max-height .35s;
  overflow: hidden;
}
.faq-accordion[open] p {
  opacity: 1;
  max-height: 200px;
  transition: opacity .35s .08s, max-height .35s .08s;
}

/* Pour le slide/fade sur tous les enfants sauf summary */
.faq-accordion > *:not(summary) {
  animation: faqFadeIn .45s cubic-bezier(.33,1.02,.47,.98);
}
@keyframes faqFadeIn {
  from { opacity: 0; transform: translateY(-12px);}
  to { opacity: 1; transform: translateY(0);}
}

/* Responsive */
@media (max-width: 900px) {
  .faq-accordion { margin-bottom: 12px; }
  .faq-accordion summary { font-size: 1rem; padding: 14px 0 14px 0; }
  .faq-accordion .faq-ico { width: 32px; height: 32px; }
  .faq-accordion p { margin-left: 44px; }
}
  </style>
</head>
<body>
  <div class="bg-green-halo"></div>
  <header class="site">
  <div class="container row" style="justify-content:space-between;">
    <div style="display:flex;align-items:center;gap:24px;">
      <div class="logo" style="margin-left:-18px;">
        <img src="https://i.ibb.co/23jrYqM8/c83b0d1d-822f-4902-9dcf-d329f164b778-removebg-preview.png" alt="Printxe3D Logo" style="height:110px;">
        <span class="pill" id="currency-pill">€ EUR</span>
      </div>
    </div>
    <nav style="display:flex;gap:1.5rem;justify-content:center;align-items:center;flex:1;">
      <a href="#home">Accueil</a>
      <a href="#store">Boutique</a>
      <a href="#configurator">Configurateur</a>
      <a href="#about">À propos</a>
      <a href="#contact">Contact</a>
    </nav>
    <div>
      <button class="btn btn-acc" id="openCart">Panier</button>
    </div>
  </div>
</header>

  <main>
    <!-- HERO -->
    <section class="hero section" id="home">
      <div class="halo"></div>
      <div class="container heroRow">
        <div>
          <p class="muted" style="letter-spacing:.25em;text-transform:uppercase;font-size:.72rem">Solutions d'impression 3D</p>
          <h1 class="h1 title">Donnez <span style="color:var(--accent)">vie</span> à vos idées.</h1>
          <p class="muted" style="max-width:52ch">Prototypage, pièces sur‑mesure et produits finis – qualité industrielle, délais express.</p>
          <div style="display:flex;gap:10px;margin-top:14px">
            <a class="btn btn-acc" href="#store">Découvrir la boutique</a>
            <a class="btn btn-ghost" href="#configurator">Configurateur 3D</a>
          </div>
          <div class="muted" style="margin-top:18px;opacity:.7;font-size:.8rem">Prusa · Elegoo · Bambu Lab · Anycubic · Creality</div>
        </div>
        <div class="viewer" id="heroViewer" style="position:relative;">
          <model-viewer
  src="https://contactprintxe3d-star.github.io/mon-modele-3d/logo3D.gltf"
  alt="Logo 3D"
  auto-rotate
  auto-rotate-delay="0"
  rotation-per-second="1.5"
  camera-orbit="0deg 75deg 140m"
  min-camera-orbit="auto auto 140m"
  max-camera-orbit="auto auto 140m"
  disable-zoom
  disable-pan
  camera-controls
  background-color="transparent"
  poster="https://contactprintxe3d-star.github.io/mon-modele-3d/poster.png"
  style="width:100%;height:500px;background:transparent;box-shadow:none;border-radius:0;border:none;display:block;">
</model-viewer>
        </div>
      </div>
    </section>

    <!-- SECTION: Pourquoi Printxe3D -->  
<section id="pourquoi" class="section">  
  <div class="container">  
    <div style="text-align:center; margin-bottom: 18px;">
  <h2 class="h1" style="margin-top:10px;line-height:1.08">
    Pourquoi choisir <span style="color:var(--accent);text-shadow:0 0 8px #d7ff2f66;">Printxe3D</span>
  </h2>
  <p class="muted" style="max-width:700px;margin:18px auto 0;font-size:1.13rem;line-height:1.6;letter-spacing:.01em;">
    Du premier prototype à la petite série,<br>
    <span style="color:var(--accent);font-weight:600;">
      expertise matière, parc machines multi-technos et suivi projet personnalisé
    </span>
    pour livrer des pièces fiables, au bon coût et dans les temps.
  </p>
</div>  

    <div class="grid featGrid" style="margin-top:32px">
  <div class="card pad shadow feature-card">
    <div class="feature-ico" style="background:rgba(215,255,47,0.13)">
      <svg width="32" height="32" fill="none" stroke="currentColor" stroke-width="2"><rect x="6" y="6" width="20" height="20" rx="5" stroke="#D7FF2F"/><path d="M10 16h12M16 10v12" stroke="#D7FF2F"/></svg>
    </div>
    <h3 class="h3 accent">Qualité industrielle</h3>
    <p class="muted">Tolérances serrées, répétabilité contrôlée et contrôle qualité sur chaque lot.</p>
  </div>
  <div class="card pad shadow feature-card">
    <div class="feature-ico" style="background:rgba(215,255,47,0.13)">
      <svg width="32" height="32" fill="none" stroke="currentColor" stroke-width="2"><path d="M8 16l6 6 10-10" stroke="#D7FF2F"/><circle cx="16" cy="16" r="15" stroke="#D7FF2F" opacity=".3"/></svg>
    </div>
    <h3 class="h3 accent">Délais rapides</h3>
    <p class="muted">Prototypage dès 48h et options express selon votre urgence.</p>
  </div>
  <div class="card pad shadow feature-card">
    <div class="feature-ico" style="background:rgba(215,255,47,0.13)">
      <svg width="32" height="32" fill="none" stroke="currentColor" stroke-width="2"><rect x="7" y="7" width="18" height="18" rx="4" stroke="#D7FF2F"/><path d="M16 11v10M11 16h10" stroke="#D7FF2F"/></svg>
    </div>
    <h3 class="h3 accent">Matériaux certifiés</h3>
    <p class="muted">PA12, PETG, ASA, chargés fibres… fiches techniques et traçabilité disponibles.</p>
  </div>
  <div class="card pad shadow feature-card">
    <div class="feature-ico" style="background:rgba(215,255,47,0.13)">
      <svg width="32" height="32" fill="none" stroke="currentColor" stroke-width="2"><circle cx="16" cy="16" r="12" stroke="#D7FF2F"/><path d="M16 10v6l4 2" stroke="#D7FF2F"/></svg>
    </div>
    <h3 class="h3 accent">Accompagnement d’experts</h3>
    <p class="muted">Conseil DfAM, choix matière/process et optimisation coût/performances.</p>
  </div>
</div>  

    <div class="card pad shadow" id="statsCounterBlock" style="margin-top:32px;background:linear-gradient(120deg,#161616 60%,#181818 100%);border:1.5px solid rgba(215,255,47,0.10)">
      <div class="grid" style="grid-template-columns:repeat(4,1fr);gap:20px;text-align:center">
        <div>
          <div class="muted text-sm" style="letter-spacing:.08em;">pièces livrées</div>
          <div class="price stat-counter" data-target="1200" data-prefix="+">0</div>
        </div>
        <div>
          <div class="muted text-sm" style="letter-spacing:.08em;">satisfaction client</div>
          <div class="price stat-counter" data-target="98.7" data-suffix="%" data-decimals="1">0</div>
        </div>
        <div>
          <div class="muted text-sm" style="letter-spacing:.08em;">prototypage</div>
          <div class="price stat-counter" data-target="48" data-suffix="h">0</div>
        </div>
        <div>
          <div class="muted text-sm" style="letter-spacing:.08em;">pas de minimum</div>
          <div class="price stat-counter" data-target="0" data-suffix=" MOQ">0</div>
        </div>
      </div>
    </div>  
  </div>  
</section>

    <!-- STORE -->
    <section class="section" id="store">
      <div class="container">
        <div style="display:flex;align-items:end;justify-content:space-between;gap:12px;flex-wrap:wrap">
          <div>
            <p class="muted" style="letter-spacing:.25em;text-transform:uppercase;font-size:.72rem">Online Store</p>
            <h2 class="h2">Nos produits</h2>
          </div>
          <div class="toolbar">
            <input id="search" placeholder="Rechercher…" />
            <select id="category"></select>
            <select id="sort">
              <option value="rating">Mieux noté</option>
              <option value="price-asc">Prix ↑</option>
              <option value="price-desc">Prix ↓</option>
            </select>
            <select id="rating">
              <option value="0">Note ≥ 0★</option>
              <option value="3">Note ≥ 3★</option>
              <option value="4">Note ≥ 4★</option>
              <option value="4.5">Note ≥ 4.5★</option>
            </select>
            <select id="price">
              <option value="all">Tous prix</option>
              <option value="0-50">0–50</option>
              <option value="50-100">50–100</option>
              <option value="100-200">100–200</option>
            </select>
          </div>
        </div>
        <div class="grid prodGrid" id="grid" style="margin-top:16px"></div>
        <div style="display:flex;justify-content:center;margin-top:18px">
          <button class="btn" id="loadMore" style="border-color:rgba(255,255,255,.12)">Charger plus</button>
        </div>
      </div>
    </section>

    <!-- CONFIGURATOR -->
    <section class="section" id="configurator">
      <div class="container">
        <h2 class="h2">Configurateur 3D</h2>
        <div class="grid" style="grid-template-columns:1.1fr .9fr">
          <div class="card" style="padding:10px">
            <div id="cfgViewer" class="viewer"></div>
          </div>
          <div class="card pad">
            <div style="display:grid;gap:10px">
              <label>Upload STL/OBJ <input id="file3d" type="file" accept=".stl,.obj" class="input" /></label>
              <label>Finition <select id="cfgFin" class="input"><option>Brut</option><option>Poli</option><option>Peint</option></select></label>
              <label>Couleur <input id="cfgColor" type="color" value="#dddddd" class="input" /></label>
              <div>Prix estimé: <strong class="price" id="cfgPrice">—</strong></div>
              <button class="btn btn-acc" id="cfgAdd">Ajouter au panier</button>
            </div>
          </div>
        </div>
      </div>
    </section>

    <!-- ABOUT / PROCESS -->
    <section class="section" id="about">
      <div class="container">
        <h2 class="h2">Notre process</h2>
        <div class="grid" style="grid-template-columns:repeat(3,1fr)">
          <div class="card pad"><h3 class="h3">Upload</h3><p class="muted">Déposez votre fichier, choisissez options & matériaux.</p></div>
          <div class="card pad"><h3 class="h3">Validation</h3><p class="muted">Contrôle fichier & devis transparent.</p></div>
          <div class="card pad"><h3 class="h3">Production</h3><p class="muted">Impression, post‑traitement, contrôle qualité.</p></div>
        </div>
      </div>
    </section>

    <!-- CONTACT -->
    <section class="section" id="contact">
      <div class="container">
        <h2 class="h2">FAQ & Contact</h2>
        <div class="grid" style="grid-template-columns:1fr 1fr">
          <div class="card pad">
            <!-- FAQ MODERNE AVEC ICÔNES ET ANIMATION -->
<div class="card pad faq-card" style="background:none;border:none;box-shadow:none;padding:0;">
  <details class="faq-accordion">
    <summary>
      <span class="faq-ico">
        <!-- Icône fichier -->
        <svg width="28" height="28" fill="none" stroke="#D7FF2F" stroke-width="2"><rect x="4" y="4" width="20" height="20" rx="5"/><path d="M9 9h10M9 14h10M9 19h10"/></svg>
      </span>
      Quels formats acceptez‑vous ?
    </summary>
    <p class="muted">STL, OBJ, STEP (convertir en STL/OBJ pour prévisualisation).</p>
  </details>
  <details class="faq-accordion">
    <summary>
      <span class="faq-ico">
        <!-- Icône livraison -->
        <svg width="28" height="28" fill="none" stroke="#D7FF2F" stroke-width="2"><rect x="3" y="10" width="18" height="8" rx="2"/><path d="M21 18v-4a2 2 0 0 0-2-2h-2"/><circle cx="8" cy="22" r="1.5"/><circle cx="18" cy="22" r="1.5"/></svg>
      </span>
      Livrez‑vous hors France ?
    </summary>
    <p class="muted">La boutique expédie en France. Sur devis, l'international est possible.</p>
  </details>
  <details class="faq-accordion">
    <summary>
      <span class="faq-ico">
        <!-- Icône délai -->
        <svg width="28" height="28" fill="none" stroke="#D7FF2F" stroke-width="2"><circle cx="14" cy="14" r="11"/><path d="M14 8v7l4 3"/></svg>
      </span>
      Délais moyens ?
    </summary>
    <p class="muted">2–5 jours ouvrés selon file d'attente et finitions.</p>
  </details>
</div>
          </div>
          <form class="card pad" id="contactForm">
  <label>E‑mail <input required type="email" name="email" class="input" /></label>
  <label style="margin-top:8px">Message <textarea required rows="5" name="message" class="input"></textarea></label>
  <button class="btn btn-acc" style="margin-top:10px" type="submit">Envoyer</button>
  <div id="contactStatus" class="muted" style="margin-top:8px"></div>
</form>
        </div>
      </div>
    </section>

    <!-- Panier page -->
<section id="cartPage" class="section" style="display:none;">
  <div class="container">
    <h2 class="h2">Votre panier</h2>
    <div id="cartPageItems" style="display:grid;gap:16px"></div>
    <div style="margin-top:18px">
      <div>Sous-total: <strong id="cartPageSubtotal">—</strong></div>
      <div>TVA (20%): <strong id="cartPageVat">—</strong></div>
      <div>Livraison: <strong id="cartPageShip">—</strong></div>
      <div>Total: <strong id="cartPageTotal" class="price">—</strong></div>
    </div>
    <a class="btn btn-acc" href="#checkout">Passer à la commande</a>
    <button class="btn" id="cartPageClear" style="margin-left:10px">Vider le panier</button>
    <button class="btn" id="cartPageBack" style="margin-top:18px">Retour boutique</button>
  </div>
</section>
  </main>

  <footer>
    <div class="container section" style="padding-top:32px;padding-bottom:32px">
      <div style="display:flex;align-items:center;justify-content:space-between;gap:12px;flex-wrap:wrap">
        <!-- FOOTER -->
        <div class="logo">
          <img src="https://i.ibb.co/23jrYqM8/c83b0d1d-822f-4902-9dcf-d329f164b778-removebg-preview.png" alt="Printxe3D Logo" style="height:110px;">
          <span class="muted">Impression 3D — France</span>
        </div>
        <div class="muted">Mentions • CGV • RGPD</div>
        <div class="muted">© <span id="year"></span> Printxe3D — Tous droits réservés.</div>
      </div>
    </div>
  </footer>

  <!-- CART DRAWER -->
  <div class="cart" id="cart">
    <div class="back" id="closeCart"></div>
    <aside>
      <div style="display:flex;align-items:center;justify-content:space-between">
        <h3>Votre panier</h3>
        <button class="btn" id="xCart" style="border-color:rgba(255,255,255,.12)">Fermer</button>
      </div>
      <div id="cartItems" style="margin-top:10px;max-height:60vh;overflow:auto;display:grid;gap:10px"></div>
      <div class="card pad" style="margin-top:10px;display:grid;gap:8px">
        <div style="display:flex;gap:8px"><input id="promo" placeholder="Code promo" class="input" style="flex:1;background:#0b0b0b;border:1px solid rgba(255,255,255,.12);border-radius:12px;padding:.6rem .8rem;color:#fff"><button class="btn" id="applyPromo">Appliquer</button></div>
        <div style="display:flex;justify-content:space-between"><span>Sous‑total</span><strong id="subtotal">—</strong></div>
        <div style="display:flex;justify-content:space-between"><span>TVA (20%)</span><strong id="vat">—</strong></div>
        <div style="display:flex;justify-content:space-between"><span>Livraison</span><strong id="ship">—</strong></div>
        <div style="display:flex;justify-content:space-between;font-size:1.2rem"><span>Total</span><strong class="price" id="total">—</strong></div>
        <a class="btn btn-acc" href="#checkout" onclick="document.getElementById('cart').classList.remove('open')">Payer maintenant</a>
        <button class="btn" id="clearCart" style="border-color:rgba(255,255,255,.12)">Vider</button>
      </div>
    </aside>
  </div>

  <!-- CHECKOUT (simple inline section) -->
  <section id="checkout" class="section" style="border-top:1px solid rgba(255,255,255,.06)">
    <div class="container">
      <h2 class="h2">Paiement du panier</h2>
      <div class="grid" style="grid-template-columns:1fr 1fr">
        <form class="card pad" id="checkoutForm">
          <h3 class="h3">Adresse</h3>
          <div class="grid" style="grid-template-columns:1fr 1fr">
            <label>Prénom<input required class="input"/></label>
            <label>Nom<input required class="input"/></label>
          </div>
          <label>E‑mail<input required type="email" class="input"/></label>
          <label>Adresse<input required class="input"/></label>
          <div class="grid" style="grid-template-columns:1fr 1fr 1fr">
            <label>Ville<input required class="input"/></label>
            <label>Code postal<input required class="input" id="zip"/></label>
            <label>Pays<input value="FR" class="input"/></label>
          </div>
          <h3 class="h3" style="margin-top:10px">Livraison (France)</h3>
          <select id="carrier" class="input">
            <option value="colissimo">Colissimo</option>
            <option value="mondial_relay">Mondial Relay</option>
          </select>
          <p class="muted">Le prix s'ajuste avec le poids du panier.</p>
          <h3 class="h3" style="margin-top:10px">Paiement</h3>
          <div class="tabs">
            <button type="button" class="active">CB / Apple Pay</button>
            <button type="button">PayPal</button>
            <button type="button">Virement</button>
          </div>
          <button class="btn btn-acc" style="margin-top:12px">Confirmer la commande</button>
        </form>
        <div class="card pad" id="summary">
          <h3 class="h3">Résumé commande</h3>
          <div id="summaryItems" style="display:grid;gap:8px;margin-top:10px"></div>
          <div style="border-top:1px solid rgba(255,255,255,.1);margin-top:10px;padding-top:10px">
            <div style="display:flex;justify-content:space-between"><span>Sous‑total</span><strong id="sSubtotal">—</strong></div>
            <div style="display:flex;justify-content:space-between"><span>TVA</span><strong id="sVat">—</strong></div>
            <div style="display:flex;justify-content:space-between"><span>Livraison</span><strong id="sShip">—</strong></div>
            <div style="display:flex;justify-content:space-between;font-size:1.1rem"><span>Total</span><strong id="sTotal" class="price">—</strong></div>
          </div>
        </div>
      </div>
    </div>
  </section>

  <!-- SCRIPTS: THREE.JS + APP -->
  <script src="https://cdn.jsdelivr.net/npm/three@0.168.0/build/three.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/three@0.168.0/examples/js/controls/OrbitControls.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/three@0.168.0/examples/js/loaders/STLLoader.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/three@0.168.0/examples/js/loaders/OBJLoader.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/emailjs-com@3/dist/email.min.js"></script>
  <script type="module" src="https://unpkg.com/@google/model-viewer/dist/model-viewer.min.js"></script>
  <script>
    (function(){
      emailjs.init("iYvgo_JQcTPk4yb_B"); // Remplace par ta Public Key EmailJS
    })();

    document.getElementById('contactForm').addEventListener('submit', function(e) {
      e.preventDefault();
      const status = document.getElementById('contactStatus');
      status.textContent = "Envoi en cours…";
      emailjs.sendForm('service_cohmx2m', 'template_d59hjbv', this)
        .then(function() {
          status.textContent = "Message envoyé ! Merci pour votre contact.";
          e.target.reset();
        }, function(error) {
          status.textContent = "Erreur lors de l'envoi. Essayez plus tard.";
        });
    });

    document.addEventListener('DOMContentLoaded', function() {
    // ---------------------- MOCK DATA --------------------------------------
    const CATEGORIES=[
      {id:'figurines',label:'Figurines'},
      {id:'bustes',label:'Bustes'},
      {id:'prototypes',label:'Prototypes'},
      {id:'accessoires',label:'Accessoires'}
    ];
    const PRODUCTS=[...Array(24)].map((_,i)=>{
      const cats=['figurines','bustes','prototypes','accessoires'];
      const title=['Mecha','Tengu','Aquila','Nomad','Titan','Golem','Drone','Sorcerer'][i%8];
      const price= (40+ (i%8)*7 + (i%5)*5);
      const rating= (Math.random()*1.2 + 3.8).toFixed(1);
      const has3D = i%3===0;
      return {id:i+1,slug:`model-${i+1}`,title:`${title} #${i+1}`,price,category:cats[i%cats.length],rating:parseFloat(rating),has3D,images:[`https://picsum.photos/seed/px${i}/600/600`],variants:[{size:'S',mat:'PLA',color:'Noir',delta:0},{size:'M',mat:'PETG',color:'Gris',delta:5},{size:'L',mat:'RESIN',color:'Blanc',delta:12}]};
    });

    // ---------------------- UTIL ------------------------------------------
    const $=sel=>document.querySelector(sel);
    const el=(tag,props={},children=[])=>{const n=document.createElement(tag);Object.assign(n,props);children.forEach(c=>n.append(c));return n};
    const fmt=(n,cur=localStorage.getItem('cur')||'EUR')=>new Intl.NumberFormat('fr-FR',{style:'currency',currency:cur}).format(n);

    // ---------------------- HEADER ACTIONS --------------------------------
    const yearEl=$('#year');yearEl.textContent=new Date().getFullYear();
    const langBtn=$('#langSwitch');
    const curPill = $('#currency-pill');
curPill.addEventListener('click', () => {
  const map = { EUR: 'USD', USD: 'GBP', GBP: 'EUR' };
  const cur = localStorage.getItem('cur') || 'EUR';
  const next = map[cur];
  localStorage.setItem('cur', next);
  curPill.textContent = (next === 'EUR' ? '€ EUR' : next === 'USD' ? '$ USD' : '£ GBP');
  render();
  updateCart();
});

    // ---------------------- GRID / FILTERS --------------------------------
    const categorySel=$('#category');categorySel.innerHTML='<option value="all">Catégories</option>'+CATEGORIES.map(c=>`<option value="${c.id}">${c.label}</option>`).join('');
    const search=$('#search');const sort=$('#sort');const ratingSel=$('#rating');const priceSel=$('#price');
    const grid=$('#grid');
    let limit = 4; // Affiche 4 articles au départ
    function render() {
      let list = [...PRODUCTS];
      const q = search.value.trim().toLowerCase();
      const cat = categorySel.value;
      const rMin = parseFloat(ratingSel.value);
      const p = priceSel.value.split('-');
      list = list.filter(pdt =>
        (cat === 'all' || pdt.category === cat) &&
        (!q || pdt.title.toLowerCase().includes(q)) &&
        (pdt.rating >= rMin)
      );
      if (priceSel.value !== 'all') list = list.filter(pdt => pdt.price >= +p[0] && pdt.price <= (+p[1]));
      if (sort.value === 'price-asc') list.sort((a, b) => a.price - b.price);
      if (sort.value === 'price-desc') list.sort((a, b) => b.price - a.price);
      if (sort.value === 'rating') list.sort((a, b) => b.rating - a.rating);
      grid.innerHTML = '';
      list.slice(0, limit).forEach((p, i) => {
        const cardEl = card(p);
        cardEl.style.animationDelay = (i * 0.08) + "s";
        grid.append(cardEl);
      });
      $('#loadMore').style.display = limit < list.length ? 'inline-flex' : 'none';
    }
    function card(p){
      const card = document.createElement('div');
      card.className = 'card prod shadow';
      card.onclick = (e) => { e.preventDefault(); openProduct(p); };
      const t = document.createElement('div');
      t.className = 'thumb';
      t.innerHTML = `<img src="${p.images[0]}" alt="${p.title}" style="width:100%;height:100%;object-fit:cover;border-radius:14px;">`;
      const b = document.createElement('div');
      b.className = 'pad';
      b.innerHTML = `
    <div class="h3">${p.title}</div>
    <div class="muted">${p.rating}★</div>
    <div class="price">${fmt(p.price)}</div>
    <div style="display:flex;gap:8px;align-items:center;margin-top:6px">
      <button class="btn btn-acc">Ajouter</button>
      <button class="btn btn-view" onclick="event.stopPropagation();openProduct(p)">Voir +</button>
    </div>
  `;
      b.querySelector('.btn.btn-acc').onclick = (e) => {
        e.preventDefault();
        e.stopPropagation();
        addToCart({id:p.id,title:p.title,price:p.price,qty:1});
      };
      card.append(t, b);
      return card;
    }
    $('#loadMore').onclick=()=>{ limit += 4; render(); };
    [search,categorySel,sort,ratingSel,priceSel].forEach(elm=>elm.addEventListener('input',()=>{limit=4;render()}));

    // ---------------------- PRODUCT MODAL ---------------------------------
    const modal=el('div',{className:'modal',id:'productModal'});
    modal.innerHTML=`<div class="box card pad"><div style="display:flex;justify-content:space-between;align-items:center;gap:10px"><h3 id="pmTitle" class="h3">Produit</h3><button id="pmClose" class="btn" style="border-color:rgba(255,255,255,.12)">Fermer</button></div><div class="grid" style="grid-template-columns:1.1fr .9fr;gap:16px;margin-top:8px"><div class="card" style="padding:10px"><div id="pmViewer" class="viewer"></div></div><div class="card pad"><div class="muted" id="pmRating"></div><div style="margin:8px 0"><strong id="pmPrice" class="price"></strong></div><div class="variantRow"><select id="pmSize"></select><select id="pmMat"></select><select id="pmColor"></select></div><div style="margin-top:10px;display:grid;gap:8px"><button id="pmAdd" class="btn btn-acc">Ajouter au panier</button><p class="muted">Galerie: image + viewer 3D si disponible.</p></div><div style="margin-top:10px"><h4 class="h3">Avis</h4><div id="pmReviews" style="display:grid;gap:8px"></div></div></div></div></div>`;
    document.body.append(modal);$('#pmClose').onclick=()=>modal.classList.remove('open');
    let pmProduct=null;let pmPrice=0;let pmViewer=null;
    function openProduct(p){
      pmProduct=p;$('#pmTitle').textContent=p.title;$('#pmRating').textContent=p.rating+'★';
      const size=$('#pmSize');const mat=$('#pmMat');const color=$('#pmColor');
      size.innerHTML='';mat.innerHTML='';color.innerHTML='';
      p.variants.forEach(v=>{const o1=el('option',{textContent:'Taille '+v.size});o1.value=v.size;size.append(o1)});
      const mats=[...new Set(p.variants.map(v=>v.mat))];mats.forEach(m=>{const o=el('option',{textContent:m});o.value=m;mat.append(o)});
      const cols=[...new Set(p.variants.map(v=>v.color))];cols.forEach(c=>{const o=el('option',{textContent:c});o.value=c;color.append(o)});
      pmPrice = p.price + (p.variants[0]?.delta||0);$('#pmPrice').textContent=fmt(pmPrice);
      size.onchange=mat.onchange=color.onchange=()=>{const v=p.variants.find(v=>v.size===size.value)||p.variants[0];pmPrice=p.price+(v?.delta||0);$('#pmPrice').textContent=fmt(pmPrice)};
      // reviews (mock + moderation approved=true only)
      const revs=[{a:'Chloé',r:5,c:'Top qualité !'},{a:'Hugo',r:4,c:'Très bien.'}];
      $('#pmReviews').innerHTML=revs.map(x=>`<div class="card pad"><div class="muted" style="font-size:.85rem">${x.a} – ${x.r}★</div><div>${x.c}</div></div>`).join('');
      // 3D viewer if available
      initViewer('#pmViewer', p.has3D ? null : 'placeholder');
      modal.classList.add('open');
      $('#pmAdd').onclick=()=>{addToCart({id:p.id,title:p.title,price:pmPrice,qty:1});modal.classList.remove('open')};
    }

    // ---------------------- THREE VIEWERS ---------------------------------
    // Supprime ou commente cette ligne pour ne pas effacer l'image du hero :
    /*
    initViewer('#heroViewer');
    */
    // Configurator viewer & price based on bbox volume
    let cfgModel=null;let cfgScene=null;let cfgRenderer=null;let cfgCam=null;
    (function(){
      const v=initViewer('#cfgViewer');
      cfgScene=v.scene;cfgRenderer=v.renderer;cfgCam=v.camera;
    })();
    function estimatePriceFromBBox(bb){ if(!bb) return 0; const sx=bb.max.x-bb.min.x, sy=bb.max.y-bb.min.y, sz=bb.max.z-bb.min.z; const vol=Math.max(sx*sy*sz,0.0001); const sizeMul={S:1,M:1.4,L:1.9}[$('#cfgSize').value]; const matMul={PLA:1,PETG:1.1,ABS:1.2,RESIN:1.35}[$('#cfgMat').value]; const finMul={Brut:1,Poli:1.15,Peint:1.5}[$('#cfgFin').value]; const base=35; return Math.round((base + vol*120) * sizeMul * matMul * finMul); }
    function updateCfgPrice(bb){$('#cfgPrice').textContent=fmt(estimatePriceFromBBox(bb)||49)}
    ['cfgSize','cfgMat','cfgFin'].forEach(id=>document.getElementById(id).addEventListener('change',()=>updateCfgPrice(cfgModel?.geometry?.boundingBox)));
    document.getElementById('file3d').addEventListener('change',e=>{
      const f = e.target.files?.[0]; 
      if(!f) return; 
      const name = f.name.toLowerCase(); 
      const url = URL.createObjectURL(f);
      if(cfgModel){cfgScene.remove(cfgModel);} // remove previous

      if(name.endsWith('.stl')){
        const loader = new THREE.STLLoader();
        loader.load(url, g => {
          g.computeBoundingBox();
          const m = new THREE.Mesh(
            g,
            new THREE.MeshStandardMaterial({color:0x888888,metalness:.1,roughness:.8})
          );
          cfgModel = m;
          cfgScene.add(m);
          updateCfgPrice(g.boundingBox);
        });
      } else if(name.endsWith('.obj')){
        const loader = new THREE.OBJLoader();
        loader.load(url, obj => {
          cfgModel = obj;
          cfgScene.add(obj);
          // Optionnel: calculer le prix si possible
        });
      }
      // NE PAS ajouter au panier ici, seulement afficher l'aperçu
    });
    // ---------------------- CART / CHECKOUT --------------------------------
    let CART = [];
const cartEl = document.getElementById('cart');
const openCartBtn = document.getElementById('openCart');
const closeCart = document.getElementById('closeCart');
const xCart = document.getElementById('xCart');

if (openCartBtn && cartEl) {
  openCartBtn.onclick = () => {
    // Cache toutes les sections principales
    document.querySelectorAll('main > section').forEach(s => s.style.display = 'none');
    // Affiche la page panier
    document.getElementById('cartPage').style.display = 'block';
    renderCartPage();
    window.scrollTo(0, document.getElementById('cartPage').offsetTop);
  }
}
if (closeCart && cartEl) {
  closeCart.onclick = () => cartEl.classList.remove('open');
}
if (xCart && cartEl) {
  xCart.onclick = () => cartEl.classList.remove('open');
}


// Ajoute la fermeture du panier avec la touche "Echap"
document.addEventListener('keydown', e => {
  if (e.key === "Escape") cartEl.classList.remove('open');
});

// Charge le panier depuis le localStorage au chargement
try {
  CART = JSON.parse(localStorage.getItem('cart') || '[]');
} catch {
  CART = [];
}

// Fonction d'ajout au panier
function addToCart(it) {
  const idx = CART.findIndex(x => x.id === it.id);
  if (idx > -1) CART[idx].qty += it.qty;
  else CART.push({ ...it });
  updateCart();
  cartEl.classList.add('open');
  localStorage.setItem('cart', JSON.stringify(CART));
}

// Fonction de mise à jour du panier
function updateCart() {
  localStorage.setItem('cart', JSON.stringify(CART));
  const items = $('#cartItems');
  items.innerHTML = '';
  let sub = 0, weight = 0;
  CART.forEach((it, idx) => {
    sub += it.price * it.qty;
    weight += (it.weight || 0.2) * it.qty;
    const row = el('div', { className: 'card pad' });
    row.append(el('div', { textContent: it.title }));
    row.append(el('div', { className: 'muted', textContent: `x${it.qty}` }));
    row.append(el('div', { className: 'price', textContent: fmt(it.price * it.qty) }));
    // Ajoute un bouton pour supprimer l'article
    const delBtn = el('button', {
      className: 'btn',
      textContent: '✕',
      onclick: () => {
        CART.splice(idx, 1);
        updateCart();
      }
    });
    delBtn.style.marginLeft = "8px";
    row.append(delBtn);
    items.append(row);
  });
  const tva = sub * 0.20;
  const ship = calcShipping(weight, ($('#carrier')?.value) || 'colissimo');
  const total = sub + tva + ship;
  $('#subtotal').textContent = fmt(sub);
  $('#vat').textContent = fmt(tva);
  $('#ship').textContent = fmt(ship);
  $('#total').textContent = fmt(total);
  // summary
  $('#summaryItems').innerHTML = CART.map(it =>
    `<div class="card pad"><div>${it.title}</div><div class="muted">x${it.qty}</div><div class="price">${fmt(it.price * it.qty)}</div></div>`
  ).join('');
  $('#sSubtotal').textContent = fmt(sub);
  $('#sVat').textContent = fmt(tva);
  $('#sShip').textContent = fmt(ship);
  $('#sTotal').textContent = fmt(total);
}

// Vider le panier
document.getElementById('clearCart').onclick = () => { CART = []; updateCart(); };

// Appliquer un code promo
document.getElementById('applyPromo').onclick = () => {
  const c = $('#promo').value.trim().toUpperCase();
  if (c === 'PXE3D10') {
    CART = CART.map(x => ({ ...x, price: Math.round(x.price * 0.9) }));
    alert('Code appliqué: -10%');
    updateCart();
  } else alert('Code invalide');
};

// Recalcul du panier si le mode de livraison change
document.getElementById('carrier').addEventListener('change', updateCart);

// Initialisation
render();
updateCart();
    // Checkout recalc when carrier changes
    document.getElementById('carrier').addEventListener('change',updateCart);

    // ---------------------- CLICK OPEN PRODUCT VIA DEEP LINK (optional) ----
    if(location.hash.startsWith('#product-')){
      const id=parseInt(location.hash.split('-')[1],10); const p=PRODUCTS.find(p=>p.id===id); if(p) openProduct(p);
    }
  });

    // Fonction pour initialiser les viewers 3D
    function initViewer(sel, placeholder) {
      const el = $(sel);
      if (!el) return;
      el.innerHTML = '';
      const width = el.clientWidth || 400, height = el.clientHeight || 400;
      const scene = new THREE.Scene();
      const camera = new THREE.PerspectiveCamera(45, width / height, 0.1, 1000);
      camera.position.set(0, 0.5, 4);

      const renderer = new THREE.WebGLRenderer({ alpha: true, antialias: true });
      renderer.setSize(width, height);
      el.appendChild(renderer.domElement);

      // Lumière
      scene.add(new THREE.HemisphereLight(0xffffff, 0x222222, 0.7));
      const dir = new THREE.DirectionalLight(0xffffff, 0.8);
      dir.position.set(5, 10, 7);
      scene.add(dir);

      // Modèle 3D ou placeholder
      if (!placeholder) {
        const loader = new THREE.STLLoader();
        loader.load('lion7.stl', geometry => {
          geometry.computeBoundingBox();
          geometry.center();
          const mesh = new THREE.Mesh(
            geometry,
            new THREE.MeshStandardMaterial({ color: 0xD7FF2F, metalness: 0.2, roughness: 0.6 })
          );
          // Normalisation taille
          const bbox = geometry.boundingBox;
          const maxSize = Math.max(
            bbox.max.x - bbox.min.x,
            bbox.max.y - bbox.min.y,
            bbox.max.z - bbox.min.z
          );
          const scale = 2.5 / maxSize;
          mesh.scale.set(scale, scale, scale);
          scene.add(mesh);
          // Animation
          function animate() {
            requestAnimationFrame(animate);
            mesh.rotation.y += 0.008;
            renderer.render(scene, camera);
          }
          animate();
        });
      } else {
        // Placeholder simple
        const box = new THREE.Mesh(
          new THREE.BoxGeometry(1, 1, 1),
          new THREE.MeshStandardMaterial({ color: 0x888888, metalness: 0.1, roughness: 0.8 })
        );
        scene.add(box);
        function animate() {
          requestAnimationFrame(animate);
          box.rotation.y += 0.008;
          renderer.render(scene, camera);
        }
        animate();
      }
    }

// Ajoute ce JS après le DOMContentLoaded pour gérer la classe active sur le menu
document.addEventListener('DOMContentLoaded', function() {
  function updateNavActive() {
    const hash = location.hash || "#home";
    document.querySelectorAll('nav a').forEach(a => {
      const href = a.getAttribute('href');
      if ((hash === "" && href === "#home") || hash === href) {
        a.classList.add('active');
      } else {
        a.classList.remove('active');
      }
    });
  }
  window.addEventListener('hashchange', updateNavActive);
  updateNavActive();
});
  </script>
  <script>
document.addEventListener('DOMContentLoaded', function() {
  let countersStarted = false;
  function animateCounter(el) {
    const target = parseFloat(el.dataset.target);
    const prefix = el.dataset.prefix || "";
    const suffix = el.dataset.suffix || "";
    const decimals = parseInt(el.dataset.decimals || "0", 10);
    let current = 0;
    let step = Math.max(target / 60, 1);
    if (target < 10) step = 0.1;
    const duration = 1200; // ms
    const start = performance.now();
    function update(now) {
      const progress = Math.min((now - start) / duration, 1);
      let value = current + (target - current) * progress;
      if (decimals) value = value.toFixed(decimals);
      else value = Math.round(value);
      el.textContent = prefix + value + suffix;
      if (progress < 1) requestAnimationFrame(update);
      else el.textContent = prefix + target + suffix;
    }
    requestAnimationFrame(update);
  }

  // Lance le compteur seulement quand la section est visible
  const statsBlock = document.getElementById('statsCounterBlock');
  if (statsBlock) {
    const observer = new IntersectionObserver((entries) => {
      if (entries[0].isIntersecting && !countersStarted) {
        countersStarted = true;
        statsBlock.querySelectorAll('.stat-counter').forEach(animateCounter);
        observer.disconnect();
      }
    }, { threshold: 0.4 });
    observer.observe(statsBlock);
  }
});
</script>
</body>
</html>
